# 基础部分

## 设备通讯原理介绍

WINGFLEXSIM 设备使用USB HID发送自定义报告来完成通讯功能。

### 数据速率、帧大小

设备会周期性地上传按键输入数据（1kHz），每帧 64 Bytes。

连接软件需周期性地发送消息给设备，例如灯光信号等。建议频率: 1kHz，每帧 64 Bytes。 （部分产品具有1-3秒无数据输入会自动关闭的功能。）

### 数据定义

每个设备均有定义上行数据和下行数据。

- 上行数据：设备发送给电脑的数据。
- 下行数据：电脑发送给设备的数据。

设`Uint8 Bytes[64]`作为上行数据的数组，上行数据的数据结构如下所示

- `Bytes[0]-[2]`：设备固定消息头字节，长度为3个字节，具体取值由各设备的协议中定义。
- `Bytes[3]`：本次发送的数据包含几种类型的数据。
  - 在协议文档中使用术语“Data Type”来表示。
  - 最多有3种不同的类型。假设本次发送的数据包含1种类型，则取值0x01；包含3种类型，则取值0x03。单次发送的数据可以由比特型、单字节型、双字节型数据组成。
- `Bytes[4]`：类型声明字节，表示接下来若干字节的数据类型。
  - 在协议文档中使用术语“Data Type”来表示，如果本次发送的数据包含3种类型，则这个“Data Type”类型声明字节会出现三次。
  - 取值：比特性(0x01)，单字节型(0x02)，双字节型(0x03)。
- `Bytes[5]`：该类型数据长度声明字节，单位是字节。
  - 在协议文档中使用术语“Data Length”来表示
  - 假设后面紧跟着1个字节数据，用3 bits表示3个开关状态，长度声明字节取值为0x01。
  - 同样的，如果后面紧跟着3个字节数据，用20 bits表示20个开关状态，长度声明字节取值为0x03。
- `Bytes[6]-[n]`：数据字节。
- `Bytes[n+1]`：“Data Type”。如果有第二种数据，这里表示第二种数据的类型。
- `Bytes[n+2]`：“Data Length”。如果有第二种数据，这里表示第二种数据的所占的字节长度。

下行数据结构参考上述说明进行解析。

## 连接示例

[USB HID 连接示例.html]()